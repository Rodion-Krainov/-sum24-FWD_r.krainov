<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XKCD Comic Fetcher</title>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
<header>
    <h1>Krainov Rodion Aleksandrovich</h1>
    <nav>
        <a href="pages/about.html">About Me</a>
        <a href="pages/photos.html">Photos</a>
        <a href="comic.html">Comic</a>
        <a href="pages/portfolio.html">Portfolio</a>
        <a href="pages/contact.html">Contact Me</a>
    </nav>
</header>
<main>
    <section id="comic-section">
        <img id="comic-img" alt="Comic Image" />
        <h2 id="comic-title"></h2>
        <p id="comic-date"></p>
    </section>
</main>
<footer>
    <h2>Contact</h2>
    <p>You can reach me through the following platforms:</p>
    <div class="social-links">
        <a id="gh-link" href="https://github.com/Rodion-Krainov" target="_blank">
            <img src="images/github.svg" alt="GitHub">
        </a>
        <a id="tg-link" href="https://t.me/rodion_IU" target="_blank">
            <img src="images/telegram.svg" alt="Telegram">
        </a>
        <a id="email" href="mailto:r.krainov@innopolis.university">
            <img style="color: white" src="images/email.svg" alt="Email">
        </a>
    </div>
</footer>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const email = 'r.krainov@innopolis.university';
        const comicSection = document.getElementById('comic-section');
        const comicImg = document.getElementById('comic-img');
        const comicTitle = document.getElementById('comic-title');
        const comicDate = document.getElementById('comic-date');

        // Fetch the comic ID
        fetchComicId(email)
            .then(comicId => fetchComic(comicId))
            .then(comic => displayComic(comic))
            .catch(error => console.error('Error fetching comic:', error));

        function fetchComicId(email) {
            const params = new URLSearchParams({ email });
            const url = `https://fwd.innopolis.university/api/hw2?${params.toString()}`;
            console.log('Fetching comic ID from URL:', url); // Logging the URL
            return fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Received comic ID:', data);
                    return data;
                });
        }

        function fetchComic(id) {
            const url = `https://fwd.innopolis.university/api/comic?id=${id}`;
            console.log('Fetching comic from URL:', url); // Logging the URL
            return fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok: ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Received comic data:', data);
                    return data;
                });
        }

        function displayComic(comic) {
            comicImg.src = comic.img;
            comicImg.alt = comic.alt;
            comicTitle.textContent = comic.safe_title; // Use safe_title instead of title
            const date = new Date(comic.year, comic.month - 1, comic.day);
            comicDate.textContent = date.toLocaleDateString();
        }
    });
</script>
</body>
</html>
